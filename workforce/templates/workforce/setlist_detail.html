<div class="container mt-4 text-white">

  <h3>{{ setlist.title }}</h3>

  <!-- Drop Zone -->
  <div id="setlistZone" class="list-group mt-3">

    {% for item in setlist.items.all %}
    <div class="list-group-item bg-surface text-white d-flex justify-content-between align-items-center"
         data-id="{{ item.id }}">
      {{ item.song.title }}
      <span class="handle">â˜°</span>
    </div>
    {% endfor %}

  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<script>
new Sortable(setlistZone, {
  animation: 150,
  handle: ".handle",
  onEnd: function () {
    const order = [];
    document.querySelectorAll("#setlistZone .list-group-item").forEach(i => {
      order.push(i.dataset.id);
    });

    fetch("{% url 'workforce:reorder_setlist' setlist.id %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": "{{ csrf_token }}",
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: new URLSearchParams({ "order[]": order })
    });
  }
});
</script>
